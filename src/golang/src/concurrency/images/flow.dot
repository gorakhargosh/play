digraph flow {
        // TODO:
        // 1. retry order
        // 2. payment failed - retry
        // 3. call from restaurant restaurant_menu.
        // 4. failed orders

        graph [
               fontname="Ubuntu,Roboto-Light,HelveticaNeue-Light,Helvetica,sans-serif",
               fontsize="28px"
               ];
        node [
              fontname="Ubuntu,Roboto,HelveticaNeue,Helvetica,sans-serif",
              fontsize="12px",
              penwidth="1.0",
              margin="0.2",
              shape=rectangle
              ];
        edge [
              fontname="Ubuntu,Roboto-Light,HelveticaNeue-Light,Helvetica,sans-serif",
              fontsize="11px",
              fontcolor=darkgray,
              penwidth="0.8"
              ];

        // Entry points have a green border.
        // Exit points have a red border.
        subgraph cluster_search {
                color=cornflowerblue;
                fontcolor=cornflowerblue;
                fillcolor="#e5e5e5";
                label="Search";

                search;
                search_recent;
                search_results;
                search_completions;

        }


        subgraph cluster_auth {
                color=cornflowerblue;
                fontcolor=cornflowerblue;
                fillcolor="#e5e5e5";
                label="Authentication";

                auth;
                auth_phone;
                auth_google;
                auth_facebook;
                authenticated;
        }

        subgraph cluster_restaurant {
                color=cornflowerblue;
                fontcolor=cornflowerblue;
                fillcolor="#e5e5e5";
                label="Restaurant";

                restaurant;
                restaurant_menu;
                restaurant_reviews;

        }

        // ---------------------------------------------------------------------
        // Nodes.
        auth [label="Authentication"]
        authenticated [label="Authenticated"]
        cart [label="Cart"]
        cart_summary [label="Cart Summary Overlay"]
        cash_wallet [label="Cash Wallet"]
        cash_wallet_summary [label="Cash Wallet Summary"]
        favorites [label="Favorites"]
        navigation [label="Navigation"]
        notifications [label="Notifications"]
        offer_detail [label="Offer Detail"]
        offers [label="Offers"]
        order_detail [label="Order Detail"]
        order_tracking [label="Order Tracking"]
        payment [label="Payment Information"]
        payment_coupon_scanner [label="Sodexo Coupon Scanner"]
        places [label="Update Location"]
        recent_orders [label="Recent Orders"]
        restaurant_menu [label="Restaurant Menu"]
        restaurant_reviews [label="Restaurant Reviews/Rating"]
        restaurants_nearby [label="Restaurants Nearby"]
        search_completions [label="Completion: Queries; Filter: Recent Orders"]
        search_recent [label="Recent: Queries, Orders, Restaurants"]
        search_results [label="Search Results"]
        settings [label="Settings"]
        shipping_info [label="Shipping Information"]
        welcome [label="Welcome (Android)"]

        // Landing nodes.
        restaurant [label="Restaurant",style=filled,fillcolor=cornflowerblue,color=cornflowerblue,fontcolor=white]
        search [label="Search",style=filled,fillcolor=cornflowerblue,color=cornflowerblue,fontcolor=white]
        welcome [label="Welcome",style=filled,fillcolor=cornflowerblue,color=cornflowerblue,fontcolor=white]

        // Internal services.
        auth_facebook [label="Facebook Authentication",style=filled,fillcolor=gray,color=gray,fontcolor=white]
        auth_google [label="Google Authentication",style=filled,fillcolor=gray,color=gray,fontcolor=white]
        auth_phone [label="Phone Authentication",style=filled,fillcolor=gray,color=gray,fontcolor=white]

        // Nodes outside the system.
        android_search [label="Android Search",style=filled,fillcolor=black,fontcolor=white]
        app_launcher [label="App Launcher",style=filled,fillcolor=black,fontcolor=white]
        google_search [label="Google Search",style=filled,fillcolor=black,fontcolor=white]
        payment_gateway [label="Payment Gateway",style=filled,fillcolor=black,fontcolor=white]
        phone_dialer [label="Phone Dialer",style=filled,fillcolor=black,fontcolor=white]
        social_network [label="Social Network",style=filled,fillcolor=black,fontcolor=white]


        // ---------------------------------------------------------------------
        // Edges.
        // Entries into the system.
        android_search -> restaurant [label="searches for restaurant",color=green,penwidth="1.5"]
        app_launcher -> restaurant [label="opens app at",color=green,penwidth="1.5"]
        app_launcher -> search [label="opens app near",color=green,penwidth="1.5"]
        app_launcher -> welcome [label="opens app (welcome)",color=green,penwidth="1.5"]
        google_search -> restaurant [label="searches for restaurant",color=green,penwidth="1.5"]
        social_network -> restaurant [label="visits restaurant",color=green,penwidth="1.5"]
        social_network -> search [label="visits us",color=green,penwidth="1.5"]
        social_network -> offer_detail [label="view offer",color=green,penwidth="1.5"]

        // Exits out of the system.
        offer_detail -> social_network [label="share on social network",color=red,penwidth="1.5"]
        restaurant -> phone_dialer [label="call",color=red,penwidth="1.5"]


        authenticated -> payment [label="receive user information"]
        authenticated -> search [label="authenticated landing (welcome)"]
        cart -> auth [label="place order"]
        cart -> navigation [label="view navigation"]
        cart -> restaurant [label="select restaurant"]
        cash_wallet -> payment_coupon_scanner [label="scan coupon"]
        navigation -> cash_wallet [label="view cash wallet"]
        navigation -> notifications [label="view notifications"]
        navigation -> offers [label="view offers"]
        navigation -> recent_orders [label="view recent orders"]
        navigation -> restaurants_nearby [label="view restaurants nearby"]
        navigation -> settings [label="view settings"]
        offer_detail -> cart [label="apply offer"]
        order_detail -> cart [label="reorder"]
        payment -> shipping_info [label="add delivery location"]
        payment_coupon_scanner -> cash_wallet [label="open cash wallet"]
        payment_coupon_scanner -> cash_wallet_summary [label="add to balance",style=dotted]
        payment_gateway -> order_tracking [label="payment successful"]
        payment_gateway -> payment [label="payment failure; attempt alternative"]
        places -> restaurant [label="view restaurant"]
        places -> search [label="update location"]
        restaurant -> navigation [label="view navigation"]
        restaurant -> order_detail [label="view order"]
        restaurant -> order_detail [label="view order"]
        restaurant -> places [label="change location"]
        restaurant -> restaurant_menu [label="open restaurant menu"]
        restaurant -> restaurant_reviews [label="view ratings"]
        restaurant -> restaurant_reviews [label="view reviews"]
        restaurant_menu -> cart_summary [label="add to cart",style=dotted]
        restaurant_menu -> cart_summary [label="remove from cart",style=dotted]
        restaurant_menu -> navigation [label="view navigation"]
        restaurant_menu -> restaurant_menu [label="filter"]
        search -> navigation [label="view navigation"]
        search -> offer_detail [label="view offer"]
        search -> order_detail [label="view order"]
        search -> places [label="view nearby places"]
        search -> restaurant [label="view recent restaurant"]
        search -> restaurant [label="view restaurant"]
        search -> search_recent [label="search"];
        search_completions -> order_detail [label="view order"]
        search_completions -> search_results [label="select query"]
        search_recent -> order_detail [label="view order"]
        search_recent -> restaurant [label="select restaurant"]
        search_recent -> search_completions [label="type query"]
        search_recent -> search_results [label="select query"]
        search_results -> cart_summary [label="add to cart",style=dotted]
        search_results -> cart_summary [label="remove from cart",style=dotted]
        shipping_info -> payment_gateway [label="pay"]
        welcome -> auth [label="authenticate (welcome)"]

        // Authentication.
        auth -> auth_facebook [label="provide facebook credentials"]
        auth -> auth_google [label="provide google credentials"]
        auth -> auth_phone [label="provide phone number"]
        auth -> authenticated [label="already authenticated"]
        auth_facebook -> auth_phone [label="verify phone number"]
        auth_google -> auth_phone [label="verify phone number"]
        auth_phone -> authenticated [label="",style=dotted]

        // Define this at the end:
        // See: http://stackoverflow.com/questions/4714262/graphviz-dot-captions
        label="Screens and Flow";
        labelloc=top;
        labeljust=left;
}
